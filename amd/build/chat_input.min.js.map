{"version":3,"file":"chat_input.min.js","sources":["../src/chat_input.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\nconst Selectors = {\n    FORM: '#mod_moodlechatbot_input_form_',\n    INPUT: '[data-region=\"input\"]',\n    SEND_BUTTON: '[data-action=\"send\"]',\n    CHATBOT_ID: 'input[name=\"chatbotid\"]',\n    SESSKEY: 'input[name=\"sesskey\"]'\n};\n\n/**\n * Initialize the chat input functionality.\n *\n * @param {string} uniqueId The unique identifier for this chat instance.\n */\nexport const init = (uniqueId) => {\n    const form = document.querySelector(Selectors.FORM + uniqueId);\n    const input = form.querySelector(Selectors.INPUT);\n    const submitButton = form.querySelector(Selectors.SEND_BUTTON);\n\n    const sendMessage = () => {\n        const message = input.value.trim();\n        if (!message) {\n            return;\n        }\n\n        const chatbotId = form.querySelector(Selectors.CHATBOT_ID).value;\n        const sesskey = form.querySelector(Selectors.SESSKEY).value;\n\n        Ajax.call([{\n            methodname: 'mod_moodlechatbot_send_message',\n            args: {\n                chatbotid: chatbotId,\n                message: message,\n                sesskey: sesskey\n            },\n            done: (response) => {\n                if (response.status === 'success') {\n                    // Clear the input\n                    input.value = '';\n                    // Trigger a custom event to update the chat display\n                    const event = new CustomEvent('mod_moodlechatbot:messagesent', {\n                        detail: response.message,\n                        bubbles: true\n                    });\n                    form.dispatchEvent(event);\n                } else {\n                    Notification.alert('Error', response.message);\n                }\n            },\n            fail: Notification.exception\n        }]);\n    };\n\n    form.addEventListener('submit', (e) => {\n        e.preventDefault();\n        sendMessage();\n    });\n\n    submitButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        sendMessage();\n    });\n};\n"],"names":["Selectors","uniqueId","form","document","querySelector","input","submitButton","sendMessage","message","value","trim","chatbotId","sesskey","call","methodname","args","chatbotid","done","response","status","event","CustomEvent","detail","bubbles","dispatchEvent","alert","fail","Notification","exception","addEventListener","e","preventDefault"],"mappings":"uXAGMA,eACI,iCADJA,gBAEK,wBAFLA,sBAGW,uBAHXA,qBAIU,0BAJVA,kBAKO,sCAQQC,iBACXC,KAAOC,SAASC,cAAcJ,eAAiBC,UAC/CI,MAAQH,KAAKE,cAAcJ,iBAC3BM,aAAeJ,KAAKE,cAAcJ,uBAElCO,YAAc,WACVC,QAAUH,MAAMI,MAAMC,WACvBF,qBAICG,UAAYT,KAAKE,cAAcJ,sBAAsBS,MACrDG,QAAUV,KAAKE,cAAcJ,mBAAmBS,oBAEjDI,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFC,UAAWL,UACXH,QAASA,QACTI,QAASA,SAEbK,KAAOC,cACqB,YAApBA,SAASC,OAAsB,CAE/Bd,MAAMI,MAAQ,SAERW,MAAQ,IAAIC,YAAY,gCAAiC,CAC3DC,OAAQJ,SAASV,QACjBe,SAAS,IAEbrB,KAAKsB,cAAcJ,kCAENK,MAAM,QAASP,SAASV,UAG7CkB,KAAMC,sBAAaC,cAI3B1B,KAAK2B,iBAAiB,UAAWC,IAC7BA,EAAEC,iBACFxB,iBAGJD,aAAauB,iBAAiB,SAAUC,IACpCA,EAAEC,iBACFxB"}