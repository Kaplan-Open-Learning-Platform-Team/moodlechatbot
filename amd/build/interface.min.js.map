{"version":3,"file":"interface.min.js","sources":["../src/interface.js"],"sourcesContent":["\n\n/**\n * Moodle chatbot interface module.\n *\n * @module mod_moodlechatbot/interface\n */\ndefine('mod_moodlechatbot/interface', ['jquery', 'core/ajax', 'core/log'], function($, ajax, log) {\n    'use strict';\n\n    log.debug('Moodle chatbot interface module loaded');\n\n    /**\n     * Display a message in the chat interface.\n     *\n     * @param {string} message - The message to display.\n     * @param {string} sender - The sender of the message ('user' or 'bot').\n     */\n    function displayMessage(message, sender) {\n        const messageElement = $('<div>').addClass('message').addClass(sender);\n        messageElement.text(message);\n        $('#moodlechatbot-messages').append(messageElement);\n        $('#moodlechatbot-messages').scrollTop($('#moodlechatbot-messages')[0].scrollHeight);\n    }\n\n    /**\n     * Send a message to the Ollama API and handle the response.\n     *\n     * @param {string} message - The message to send to the API.\n     */\n    function sendMessageToOllama(message) {\n        log.debug('Sending message to Ollama: ' + message);\n        const ollamaUrl = 'http://192.168.0.102:11434/api/chat'; // Replace with the correct Ollama API endpoint\n\n        ajax.call({\n            url: ollamaUrl,\n            type: 'POST',\n            data: JSON.stringify({\n                \"model\": \"PHI3.5\", // Use the appropriate model name\n                \"messages\": [\n                    {\n                        \"role\": \"user\",\n                        \"content\": message // The user's input message\n                    }\n                ],\n                \"stream\": false // Assuming you don't want to use streaming\n            }),\n            success: function(response) {\n                log.debug('Received response from Ollama:', response);\n                // Access the content of the assistant's message\n                let botMessage = response.message && response.message.content\n                    ? response.message.content\n                    : \"No response received from the assistant.\";\n\n                displayMessage(botMessage, 'bot');\n            },\n            error: function(xhr, status, error) {\n                log.error('Error in Ollama API call:', error);\n                displayMessage(\"An error occurred: \" + error, 'bot');\n            }\n        });\n    }\n\n    return {\n        /**\n         * Initialize the chatbot interface.\n         */\n        init: function() {\n            log.debug('Moodle chatbot interface initialized');\n            $(document).ready(function() {\n                $('#moodlechatbot-send').click(function() {\n                    const userMessage = $('#moodlechatbot-textarea').val();\n                    if (userMessage.trim() !== '') {\n                        log.debug('User sent message: ' + userMessage);\n                        displayMessage(userMessage, 'user');\n                        sendMessageToOllama(userMessage);\n                        $('#moodlechatbot-textarea').val('');\n                    }\n                });\n\n                $('#moodlechatbot-textarea').keypress(function(e) {\n                    if (e.which === 13 && !e.shiftKey) {\n                        $('#moodlechatbot-send').click();\n                        return false;\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","log","displayMessage","message","sender","messageElement","addClass","text","append","scrollTop","scrollHeight","debug","init","document","ready","click","userMessage","val","trim","call","url","type","data","JSON","stringify","success","response","content","error","xhr","status","keypress","e","which","shiftKey"],"mappings":"AAOAA,qCAAsC,CAAC,SAAU,YAAa,aAAa,SAASC,EAAGC,KAAMC,cAWhFC,eAAeC,QAASC,cACvBC,eAAiBN,EAAE,SAASO,SAAS,WAAWA,SAASF,QAC/DC,eAAeE,KAAKJ,SACpBJ,EAAE,2BAA2BS,OAAOH,gBACpCN,EAAE,2BAA2BU,UAAUV,EAAE,2BAA2B,GAAGW,qBAZ3ET,IAAIU,MAAM,0CAqDH,CAIHC,KAAM,WACFX,IAAIU,MAAM,wCACVZ,EAAEc,UAAUC,OAAM,WACdf,EAAE,uBAAuBgB,OAAM,iBACrBC,YAAcjB,EAAE,2BAA2BkB,UAzCpCd,QA0Cc,KAAvBa,YAAYE,SACZjB,IAAIU,MAAM,sBAAwBK,aAClCd,eAAec,YAAa,QA5CnBb,QA6CWa,YA5CpCf,IAAIU,MAAM,8BAAgCR,SAG1CH,KAAKmB,KAAK,CACNC,IAHc,sCAIdC,KAAM,OACNC,KAAMC,KAAKC,UAAU,OACR,kBACG,CACR,MACY,eACGrB,kBAGT,IAEdsB,QAAS,SAASC,UACdzB,IAAIU,MAAM,iCAAkCe,UAM5CxB,eAJiBwB,SAASvB,SAAWuB,SAASvB,QAAQwB,QAChDD,SAASvB,QAAQwB,QACjB,2CAEqB,QAE/BC,MAAO,SAASC,IAAKC,OAAQF,OACzB3B,IAAI2B,MAAM,4BAA6BA,OACvC1B,eAAe,sBAAwB0B,MAAO,UAkBtC7B,EAAE,2BAA2BkB,IAAI,QAIzClB,EAAE,2BAA2BgC,UAAS,SAASC,MAC3B,KAAZA,EAAEC,QAAiBD,EAAEE,gBACrBnC,EAAE,uBAAuBgB,SAClB"}