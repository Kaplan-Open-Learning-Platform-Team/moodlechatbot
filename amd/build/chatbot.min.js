define("mod_moodlechatbot/chatbot",["exports","core/ajax","core/notification","core/str"],(function(_exports,_ajax,_notification,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;const Selectors_messages="#moodlechatbot-messages",Selectors_input={textarea:"#moodlechatbot-textarea",send:"#moodlechatbot-send"},addMessageToChat=(sender,message)=>{const messagesContainer=document.querySelector(Selectors_messages),messageElement=document.createElement("div");messageElement.classList.add("message","".concat(sender,"-message")),messageElement.textContent=message,messagesContainer.appendChild(messageElement),messagesContainer.scrollTop=messagesContainer.scrollHeight},sendMessage=()=>{const textarea=document.querySelector(Selectors_input.textarea),userMessage=textarea.value.trim();userMessage&&(addMessageToChat("user",userMessage),textarea.value="",textarea.style.height="auto",(userMessage=>(0,_ajax.call)([{methodname:"mod_moodlechatbot_get_bot_response",args:{message:userMessage}}])[0].then((response=>(console.log("Raw server response:",response),response))).catch((error=>(console.error("Error fetching bot response:",error),(0,_notification.exception)(error),(0,_str.getString)("error","mod_moodlechatbot")))))(userMessage).then((response=>{console.log("Parsed server response:",response);const[botMessage,toolResult]=response.split("\n\nTool Result: ");addMessageToChat("bot",botMessage||"Error: No bot message"),toolResult&&addMessageToChat("tool","Tool Result: ".concat(toolResult))})).catch((error=>{console.error("Error processing response:",error),addMessageToChat("bot","There was an error processing your request.")})))};_exports.init=()=>{(()=>{const sendButton=document.querySelector(Selectors_input.send),textarea=document.querySelector(Selectors_input.textarea);sendButton.addEventListener("click",sendMessage),textarea.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())}))})()}}));

//# sourceMappingURL=chatbot.min.js.map