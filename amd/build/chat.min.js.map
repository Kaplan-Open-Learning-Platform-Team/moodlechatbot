{"version":3,"file":"chat.min.js","sources":["../src/chat.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Log from 'core/log';\n\nconst Selectors = {\n    CHAT_CONTAINER: '.mod_moodlechatbot_chat',\n    MESSAGES_CONTAINER: '[data-region=\"messages\"]',\n    INPUT: '[data-region=\"input\"]',\n    SEND_BUTTON: '[data-action=\"send\"]'\n};\n\nexport const init = (chatId) => {\n    const chatContainer = document.getElementById(chatId);\n    if (!chatContainer) {\n        Log.debug(`Chat container not found with id: ${chatId}`);\n        return;\n    }\n\n    const messagesContainer = chatContainer.querySelector(Selectors.MESSAGES_CONTAINER);\n    const input = chatContainer.querySelector(Selectors.INPUT);\n    const sendButton = chatContainer.querySelector(Selectors.SEND_BUTTON);\n\n    const displayMessage = async (messageData) => {\n        try {\n            const messageHtml = await Templates.renderForPromise('mod_moodlechatbot/chat_message', messageData);\n            // Only append the new message, not the entire chat interface\n            messagesContainer.insertAdjacentHTML('beforeend', messageHtml.html);\n            messagesContainer.scrollTop = messagesContainer.scrollHeight;\n        } catch (error) {\n            Log.error('Error displaying message:', error);\n            Notification.exception(error);\n        }\n    };\n\n    const sendMessage = () => {\n        const message = input.value.trim();\n        if (!message) return;\n\n        const chatbotId = chatContainer.dataset.chatbotid;\n\n        // Display user message immediately\n        displayMessage({ sender: 'You', content: message, isbot: false });\n        input.value = ''; // Clear input after sending\n\n        Ajax.call([{\n            methodname: 'mod_moodlechatbot_send_message',\n            args: { chatbotid: chatbotId, message: message },\n            done: async (response) => {\n                try {\n                    if (response.status === 'success') {\n                        // Display bot response\n                        await displayMessage({ sender: 'Bot', content: response.message, isbot: true });\n                    } else {\n                        Notification.alert('Error', response.message);\n                    }\n                } catch (error) {\n                    Log.error('Error processing response:', error);\n                    Notification.exception(error);\n                }\n            },\n            fail: (error) => {\n                Log.error('AJAX call failed:', error);\n                Notification.exception(error);\n            }\n        }]);\n    };\n\n    sendButton.addEventListener('click', sendMessage);\n    input.addEventListener('keypress', (e) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            sendMessage();\n        }\n    });\n\n    Log.debug('Chat initialized successfully');\n};\n"],"names":["Selectors","chatId","chatContainer","document","getElementById","debug","messagesContainer","querySelector","input","sendButton","displayMessage","async","messageHtml","Templates","renderForPromise","messageData","insertAdjacentHTML","html","scrollTop","scrollHeight","error","exception","sendMessage","message","value","trim","chatbotId","dataset","chatbotid","sender","content","isbot","call","methodname","args","done","response","status","alert","fail","addEventListener","e","key","shiftKey","preventDefault"],"mappings":"6eAKMA,6BAEkB,2BAFlBA,gBAGK,wBAHLA,sBAIW,qCAGIC,eACXC,cAAgBC,SAASC,eAAeH,YACzCC,uCACGG,kDAA2CJ,eAI7CK,kBAAoBJ,cAAcK,cAAcP,8BAChDQ,MAAQN,cAAcK,cAAcP,iBACpCS,WAAaP,cAAcK,cAAcP,uBAEzCU,eAAiBC,MAAAA,wBAETC,kBAAoBC,mBAAUC,iBAAiB,iCAAkCC,aAEvFT,kBAAkBU,mBAAmB,YAAaJ,YAAYK,MAC9DX,kBAAkBY,UAAYZ,kBAAkBa,aAClD,MAAOC,oBACDA,MAAM,4BAA6BA,6BAC1BC,UAAUD,SAIzBE,YAAc,WACVC,QAAUf,MAAMgB,MAAMC,WACvBF,QAAS,aAERG,UAAYxB,cAAcyB,QAAQC,UAGxClB,eAAe,CAAEmB,OAAQ,MAAOC,QAASP,QAASQ,OAAO,IACzDvB,MAAMgB,MAAQ,iBAETQ,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CAAEN,UAAWF,UAAWH,QAASA,SACvCY,KAAMxB,MAAAA,eAE0B,YAApByB,SAASC,aAEH3B,eAAe,CAAEmB,OAAQ,MAAOC,QAASM,SAASb,QAASQ,OAAO,0BAE3DO,MAAM,QAASF,SAASb,SAE3C,MAAOH,oBACDA,MAAM,6BAA8BA,6BAC3BC,UAAUD,SAG/BmB,KAAOnB,qBACCA,MAAM,oBAAqBA,6BAClBC,UAAUD,YAKnCX,WAAW+B,iBAAiB,QAASlB,aACrCd,MAAMgC,iBAAiB,YAAaC,IAClB,UAAVA,EAAEC,KAAoBD,EAAEE,WACxBF,EAAEG,iBACFtB,+BAIJjB,MAAM"}